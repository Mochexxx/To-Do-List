<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>ğŸ“ To-Do List - GestÃ£o de Tarefas e NotÃ­cias</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <!-- React and ReactDOM CDN -->
        <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
        <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
        <!-- Babel for JSX support -->
        <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
        <style>
            body { font-family: Arial, sans-serif; margin: 2rem; }
            #root { border: 1px solid #ccc; padding: 2rem; border-radius: 8px; margin-top: 0; }
        </style>
    </head>
    <body>
        <div id="root"></div>        <script src="../src/services/api.js"></script>
        <script src="../src/services/news.js"></script>
        <script type="text/babel">
// Countries data with flags and news codes
const countries = [
  { code: 'pt', name: 'Portugal', flag: 'ğŸ‡µğŸ‡¹', newsCode: 'pt' },
  { code: 'br', name: 'Brasil', flag: 'ğŸ‡§ğŸ‡·', newsCode: 'br' },
  { code: 'us', name: 'Estados Unidos', flag: 'ğŸ‡ºğŸ‡¸', newsCode: 'us' },
  { code: 'uk', name: 'Reino Unido', flag: 'ğŸ‡¬ğŸ‡§', newsCode: 'gb' },
  { code: 'es', name: 'Espanha', flag: 'ğŸ‡ªğŸ‡¸', newsCode: 'es' },
  { code: 'fr', name: 'FranÃ§a', flag: 'ğŸ‡«ğŸ‡·', newsCode: 'fr' },
  { code: 'de', name: 'Alemanha', flag: 'ğŸ‡©ğŸ‡ª', newsCode: 'de' },
  { code: 'it', name: 'ItÃ¡lia', flag: 'ğŸ‡®ğŸ‡¹', newsCode: 'it' },
  { code: 'ca', name: 'CanadÃ¡', flag: 'ğŸ‡¨ğŸ‡¦', newsCode: 'ca' },
  { code: 'au', name: 'AustrÃ¡lia', flag: 'ğŸ‡¦ğŸ‡º', newsCode: 'au' }
];

function LoginPage({ onSwitchToRegister }) {
  const [email, setEmail] = React.useState('');
  const [password, setPassword] = React.useState('');
  const [error, setError] = React.useState('');
  const [loading, setLoading] = React.useState(false);

  const handleSubmit = async (e) => {
    e.preventDefault();
    setError('');
    setLoading(true);

    try {
      await authService.login({ email, password });
      window.location.reload(); // Refresh to show authenticated state
    } catch (error) {
      setError(error.message);
    } finally {
      setLoading(false);
    }
  };

  return (
    <div style={{ maxWidth: '400px', margin: '0 auto', padding: '2rem' }}>
      <h2>ğŸ” Login</h2>
      <form onSubmit={handleSubmit}>
        <div style={{ marginBottom: '1rem' }}>
          <label>Email</label><br />
          <input
            type="email"
            value={email}
            onChange={e => setEmail(e.target.value)}
            required
            style={{ width: '100%', padding: '0.5rem', marginTop: '0.5rem' }}
          />
        </div>
        <div style={{ marginBottom: '1rem' }}>
          <label>Senha</label><br />
          <input
            type="password"
            value={password}
            onChange={e => setPassword(e.target.value)}
            required
            style={{ width: '100%', padding: '0.5rem', marginTop: '0.5rem' }}
          />
        </div>
        
        {error && (
          <div style={{ color: 'red', marginBottom: '1rem', padding: '0.5rem', backgroundColor: '#ffeeee', border: '1px solid red', borderRadius: '4px' }}>
            {error}
          </div>
        )}
        
        <button 
          type="submit" 
          disabled={loading}
          style={{ 
            width: '100%', 
            padding: '0.75rem', 
            backgroundColor: loading ? '#ccc' : '#007bff', 
            color: 'white', 
            border: 'none', 
            borderRadius: '4px',
            cursor: loading ? 'not-allowed' : 'pointer',
            marginBottom: '1rem'
          }}
        >
          {loading ? 'Entrando...' : 'Entrar'}
        </button>
      </form>
      
      <p style={{ textAlign: 'center' }}>
        NÃ£o tem uma conta? {' '}
        <button 
          onClick={onSwitchToRegister}
          style={{ background: 'none', border: 'none', color: '#007bff', cursor: 'pointer', textDecoration: 'underline' }}
        >
          Registre-se aqui
        </button>
      </p>
    </div>
  );
}

function RegisterPage({ onSwitchToLogin }) {
  const [formData, setFormData] = React.useState({
    username: '',
    email: '',
    password: '',
    confirmPassword: '',
    country: ''
  });
  const [error, setError] = React.useState('');
  const [loading, setLoading] = React.useState(false);

  const handleSubmit = async (e) => {
    e.preventDefault();
    setError('');

    if (formData.password !== formData.confirmPassword) {
      setError('As senhas nÃ£o coincidem');
      return;
    }

    if (!formData.country) {
      setError('Por favor, selecione seu paÃ­s');
      return;
    }

    setLoading(true);

    try {
      const selectedCountry = countries.find(c => c.code === formData.country);
      
      const userData = {
        username: formData.username,
        email: formData.email,
        password: formData.password,
        country: formData.country,
        countryName: selectedCountry.name,
        newsCountryCode: selectedCountry.newsCode,
        registeredAt: new Date().toISOString()
      };

      await authService.register(userData);
      alert('Registro realizado com sucesso! Agora vocÃª pode fazer login.');
      onSwitchToLogin();
    } catch (error) {
      setError(error.message);
    } finally {
      setLoading(false);
    }
  };

  const handleChange = (e) => {
    setFormData(prev => ({
      ...prev,
      [e.target.name]: e.target.value
    }));
  };

  return (
    <div style={{ maxWidth: '400px', margin: '0 auto', padding: '2rem' }}>
      <h2>ğŸ“ Registro</h2>
      <form onSubmit={handleSubmit}>
        <div style={{ marginBottom: '1rem' }}>
          <label>Nome de usuÃ¡rio</label><br />
          <input
            type="text"
            name="username"
            value={formData.username}
            onChange={handleChange}
            required
            style={{ width: '100%', padding: '0.5rem', marginTop: '0.5rem' }}
          />
        </div>
        
        <div style={{ marginBottom: '1rem' }}>
          <label>Email</label><br />
          <input
            type="email"
            name="email"
            value={formData.email}
            onChange={handleChange}
            required
            style={{ width: '100%', padding: '0.5rem', marginTop: '0.5rem' }}
          />
        </div>
        
        <div style={{ marginBottom: '1rem' }}>
          <label>PaÃ­s *</label><br />
          <small style={{ color: '#666' }}>Seu paÃ­s influenciarÃ¡ a priorizaÃ§Ã£o das notÃ­cias por regiÃ£o</small><br />
          <select
            name="country"
            value={formData.country}
            onChange={handleChange}
            required
            style={{ width: '100%', padding: '0.5rem', marginTop: '0.5rem' }}
          >
            <option value="">Selecione seu paÃ­s</option>
            {countries.map(country => (
              <option key={country.code} value={country.code}>
                {country.flag} {country.name}
              </option>
            ))}
          </select>
        </div>
        
        <div style={{ marginBottom: '1rem' }}>
          <label>Senha</label><br />
          <input
            type="password"
            name="password"
            value={formData.password}
            onChange={handleChange}
            required
            style={{ width: '100%', padding: '0.5rem', marginTop: '0.5rem' }}
          />
        </div>
        
        <div style={{ marginBottom: '1rem' }}>
          <label>Confirmar senha</label><br />
          <input
            type="password"
            name="confirmPassword"
            value={formData.confirmPassword}
            onChange={handleChange}
            required
            style={{ width: '100%', padding: '0.5rem', marginTop: '0.5rem' }}
          />
        </div>
        
        {error && (
          <div style={{ color: 'red', marginBottom: '1rem', padding: '0.5rem', backgroundColor: '#ffeeee', border: '1px solid red', borderRadius: '4px' }}>
            {error}
          </div>
        )}
        
        <button 
          type="submit" 
          disabled={loading}
          style={{ 
            width: '100%', 
            padding: '0.75rem', 
            backgroundColor: loading ? '#ccc' : '#28a745', 
            color: 'white', 
            border: 'none', 
            borderRadius: '4px',
            cursor: loading ? 'not-allowed' : 'pointer',
            marginBottom: '1rem'
          }}
        >
          {loading ? 'Registrando...' : 'Registrar'}
        </button>
      </form>
      
      <p style={{ textAlign: 'center' }}>
        JÃ¡ tem uma conta? {' '}
        <button 
          onClick={onSwitchToLogin}
          style={{ background: 'none', border: 'none', color: '#007bff', cursor: 'pointer', textDecoration: 'underline' }}
        >
          FaÃ§a login aqui
        </button>
      </p>
    </div>
  );
}

function TaskForm({ onTaskCreated }) {
  const [formData, setFormData] = React.useState({
    title: '',
    description: '',
    priority: 'mÃ©dia',
    dueDate: '',
    category: 'pessoal'
  });

  const handleSubmit = async (e) => {
    e.preventDefault();
    try {
      const task = await tasksService.createTask({
        ...formData,
        status: 'pendente'
      });
      onTaskCreated(task);
      setFormData({ title: '', description: '', priority: 'mÃ©dia', dueDate: '', category: 'pessoal' });
    } catch (error) {
      alert('Erro ao criar tarefa: ' + error.message);
    }
  };

  const handleChange = (e) => {
    setFormData(prev => ({
      ...prev,
      [e.target.name]: e.target.value
    }));
  };

  return (
    <form onSubmit={handleSubmit} style={{ marginBottom: '1.5rem', padding: '1rem', border: '1px solid #ddd', borderRadius: '8px', backgroundColor: '#f8f9fa' }}>
      <h4 style={{ margin: '0 0 1rem 0' }}>â• Nova Tarefa</h4>
      
      <div style={{ marginBottom: '1rem' }}>
        <label style={{ fontSize: '0.9rem' }}>TÃ­tulo *</label><br />
        <input
          type="text"
          name="title"
          value={formData.title}
          onChange={handleChange}
          required
          style={{ width: '100%', padding: '0.5rem', fontSize: '0.9rem' }}
        />
      </div>
      
      <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1rem', marginBottom: '1rem' }}>
        <div>
          <label style={{ fontSize: '0.9rem' }}>Categoria</label><br />
          <select
            name="category"
            value={formData.category}
            onChange={handleChange}
            style={{ width: '100%', padding: '0.5rem', fontSize: '0.9rem' }}
          >
            <option value="pessoal">Pessoal</option>
            <option value="trabalho">Trabalho</option>
            <option value="estudos">Estudos</option>
            <option value="saude">SaÃºde</option>
            <option value="financas">FinanÃ§as</option>
          </select>
        </div>
        
        <div>
          <label style={{ fontSize: '0.9rem' }}>Prioridade</label><br />
          <select
            name="priority"
            value={formData.priority}
            onChange={handleChange}
            style={{ width: '100%', padding: '0.5rem', fontSize: '0.9rem' }}
          >
            <option value="baixa">ğŸŸ¢ Baixa</option>
            <option value="mÃ©dia">ğŸŸ¡ MÃ©dia</option>
            <option value="alta">ğŸŸ  Alta</option>
            <option value="urgente">ğŸ”´ Urgente</option>
          </select>
        </div>
      </div>
      
      <div style={{ marginBottom: '1rem' }}>
        <label style={{ fontSize: '0.9rem' }}>DescriÃ§Ã£o</label><br />
        <textarea
          name="description"
          value={formData.description}
          onChange={handleChange}
          style={{ width: '100%', padding: '0.5rem', minHeight: '60px', fontSize: '0.9rem' }}
          placeholder="Descreva sua tarefa..."
        />
      </div>
      
      <div style={{ marginBottom: '1rem' }}>
        <label style={{ fontSize: '0.9rem' }}>Data limite</label><br />
        <input
          type="datetime-local"
          name="dueDate"
          value={formData.dueDate}
          onChange={handleChange}
          style={{ width: '100%', padding: '0.5rem', fontSize: '0.9rem' }}
        />
      </div>
      
      <button type="submit" style={{ width: '100%', padding: '0.6rem', backgroundColor: '#28a745', color: 'white', border: 'none', borderRadius: '4px', cursor: 'pointer', fontSize: '0.9rem' }}>
        Criar Tarefa
      </button>
    </form>
  );
}

function TaskItem({ task, onTaskUpdated, onTaskDeleted, compact = false }) {
  const [isEditing, setIsEditing] = React.useState(false);
  const [editData, setEditData] = React.useState(task);

  const priorityColors = {
    baixa: '#28a745',
    mÃ©dia: '#ffc107',
    alta: '#fd7e14',
    urgente: '#dc3545'
  };

  const statusIcons = {
    pendente: 'â³',
    em_progresso: 'ğŸ”„',
    concluÃ­da: 'âœ…'
  };

  const handleStatusChange = async (newStatus) => {
    try {
      const updatedTask = await tasksService.updateTask(task._id, { status: newStatus });
      onTaskUpdated(updatedTask);
    } catch (error) {
      alert('Erro ao atualizar tarefa: ' + error.message);
    }
  };

  const handleSaveEdit = async () => {
    try {
      const updatedTask = await tasksService.updateTask(task._id, editData);
      onTaskUpdated(updatedTask);
      setIsEditing(false);
    } catch (error) {
      alert('Erro ao salvar ediÃ§Ã£o: ' + error.message);
    }
  };

  const handleDelete = async () => {
    if (confirm('Tem certeza que deseja deletar esta tarefa?')) {
      try {
        await tasksService.deleteTask(task._id);
        onTaskDeleted(task._id);
      } catch (error) {
        alert('Erro ao deletar tarefa: ' + error.message);
      }
    }
  };

  const isOverdue = task.dueDate && new Date(task.dueDate) < new Date() && task.status !== 'concluÃ­da';

  if (isEditing) {
    return (
      <div style={{ 
        padding: compact ? '0.5rem' : '1rem', 
        border: '1px solid #ddd', 
        borderRadius: '8px', 
        marginBottom: compact ? '0.5rem' : '1rem',
        backgroundColor: '#f8f9fa',
        fontSize: compact ? '0.9rem' : '1rem'
      }}>
        <div style={{ marginBottom: '0.5rem' }}>
          <input
            type="text"
            value={editData.title}
            onChange={e => setEditData(prev => ({ ...prev, title: e.target.value }))}
            style={{ width: '100%', padding: '0.25rem', fontSize: compact ? '0.8rem' : '0.9rem' }}
          />
        </div>
        <div style={{ marginBottom: '0.5rem' }}>
          <textarea
            value={editData.description}
            onChange={e => setEditData(prev => ({ ...prev, description: e.target.value }))}
            style={{ width: '100%', padding: '0.25rem', minHeight: compact ? '40px' : '60px', fontSize: compact ? '0.8rem' : '0.9rem' }}
          />
        </div>
        <div style={{ display: 'flex', gap: '0.25rem' }}>
          <button onClick={handleSaveEdit} style={{ padding: '0.25rem 0.5rem', backgroundColor: '#28a745', color: 'white', border: 'none', borderRadius: '4px', fontSize: compact ? '0.7rem' : '0.8rem' }}>
            âœ“
          </button>
          <button onClick={() => setIsEditing(false)} style={{ padding: '0.25rem 0.5rem', backgroundColor: '#6c757d', color: 'white', border: 'none', borderRadius: '4px', fontSize: compact ? '0.7rem' : '0.8rem' }}>
            âœ•
          </button>
        </div>
      </div>
    );
  }

  return (
    <div style={{ 
      padding: compact ? '0.5rem' : '1rem', 
      border: `1px solid ${isOverdue ? '#dc3545' : '#ddd'}`, 
      borderRadius: '8px', 
      marginBottom: compact ? '0.5rem' : '1rem',
      backgroundColor: isOverdue ? '#fff5f5' : 'white',
      opacity: task.status === 'concluÃ­da' ? 0.7 : 1,
      fontSize: compact ? '0.8rem' : '1rem'
    }}>
      <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '0.25rem' }}>
        <h4 style={{ 
          margin: 0, 
          textDecoration: task.status === 'concluÃ­da' ? 'line-through' : 'none',
          color: isOverdue ? '#dc3545' : 'inherit',
          fontSize: compact ? '0.9rem' : '1.1rem',
          lineHeight: '1.2'
        }}>
          {statusIcons[task.status]} {task.title}
        </h4>
        <span style={{ 
          backgroundColor: priorityColors[task.priority], 
          color: 'white', 
          padding: compact ? '0.125rem 0.25rem' : '0.25rem 0.5rem', 
          borderRadius: '12px', 
          fontSize: compact ? '0.6rem' : '0.8rem',
          fontWeight: 'bold',
          flexShrink: 0
        }}>
          {task.priority}
        </span>
      </div>
      
      {task.description && !compact && (
        <p style={{ margin: '0.25rem 0', color: '#666', fontSize: compact ? '0.7rem' : '0.9rem' }}>{task.description}</p>
      )}
      
      <div style={{ display: 'flex', gap: compact ? '0.5rem' : '1rem', marginBottom: compact ? '0.5rem' : '1rem', fontSize: compact ? '0.7rem' : '0.9rem', color: '#666', flexWrap: 'wrap' }}>
        <span>ğŸ“‚ {task.category}</span>
        {task.dueDate && (
          <span style={{ color: isOverdue ? '#dc3545' : 'inherit' }}>
            â° {new Date(task.dueDate).toLocaleDateString('pt-BR')}
            {isOverdue && ' (!)'}
          </span>
        )}
      </div>
      
      <div style={{ display: 'flex', gap: '0.25rem', flexWrap: 'wrap' }}>
        <select
          value={task.status}
          onChange={e => handleStatusChange(e.target.value)}
          style={{ padding: compact ? '0.125rem' : '0.25rem', fontSize: compact ? '0.7rem' : '0.9rem', flex: compact ? 'none' : '1' }}
        >
          <option value="pendente">â³ Pendente</option>
          <option value="em_progresso">ğŸ”„ Em Progresso</option>
          <option value="concluÃ­da">âœ… ConcluÃ­da</option>
        </select>
        
        <button 
          onClick={() => setIsEditing(true)}
          style={{ padding: compact ? '0.125rem 0.25rem' : '0.25rem 0.5rem', backgroundColor: '#007bff', color: 'white', border: 'none', borderRadius: '4px', fontSize: compact ? '0.7rem' : '0.9rem' }}
        >
          {compact ? 'âœï¸' : 'âœï¸ Editar'}
        </button>
        
        <button 
          onClick={handleDelete}
          style={{ padding: compact ? '0.125rem 0.25rem' : '0.25rem 0.5rem', backgroundColor: '#dc3545', color: 'white', border: 'none', borderRadius: '4px', fontSize: compact ? '0.7rem' : '0.9rem' }}
        >
          {compact ? 'ğŸ—‘ï¸' : 'ğŸ—‘ï¸ Deletar'}
        </button>
      </div>
    </div>
  );
}

function NewsSection({ darkMode = false }) {
  const [news, setNews] = React.useState([]);
  const [loading, setLoading] = React.useState(true);
  const [selectedCategory, setSelectedCategory] = React.useState('general');
  const [userCountry, setUserCountry] = React.useState(null);
  const [page, setPage] = React.useState(1);
  const [hasMore, setHasMore] = React.useState(true);
  const newsContainerRef = React.useRef(null);

  const categories = [
    { id: 'general', name: 'Geral', icon: 'ğŸ“°' },
    { id: 'business', name: 'NegÃ³cios', icon: 'ğŸ’¼' },
    { id: 'technology', name: 'Tecnologia', icon: 'ğŸ’»' },
    { id: 'sports', name: 'Esportes', icon: 'âš½' },
    { id: 'health', name: 'SaÃºde', icon: 'ğŸ¥' },
    { id: 'entertainment', name: 'Entretenimento', icon: 'ğŸ¬' }
  ];

  React.useEffect(() => {
    const user = authService.getUser();
    if (user && user.country) {
      const country = countries.find(c => c.code === user.country);
      setUserCountry(country);
    }
  }, []);

  React.useEffect(() => {
    setNews([]);
    setPage(1);
    setHasMore(true);
    loadNews(1, true);
    // eslint-disable-next-line
  }, [selectedCategory, userCountry]);

  React.useEffect(() => {
    const handleScroll = () => {
      if (!newsContainerRef.current || loading || !hasMore) return;
      const { scrollTop, scrollHeight, clientHeight } = newsContainerRef.current;
      if (scrollTop + clientHeight >= scrollHeight - 100) {
        loadNews(page + 1);
      }
    };
    const ref = newsContainerRef.current;
    if (ref) ref.addEventListener('scroll', handleScroll);
    return () => { if (ref) ref.removeEventListener('scroll', handleScroll); };
  }, [loading, hasMore, page, newsContainerRef.current]);

  const loadNews = async (pageToLoad = 1, reset = false) => {
    setLoading(true);
    try {
      const countryCode = userCountry?.newsCode || 'us';
      if (!window.newsService) {
        setNews(getMockNews());
        setHasMore(false);
        return;
      }
      const pageSize = 20;
      const articles = await newsService.getNewsByCategory(selectedCategory, countryCode, pageSize, pageToLoad);
      if (!articles || articles.length === 0) {
        if (reset) setNews(getMockNews());
        setHasMore(false);
      } else {
        setNews(prev => reset ? articles : [...prev, ...articles]);
        setHasMore(articles.length === pageSize);
        setPage(pageToLoad);
      }
    } catch (error) {
      if (reset) setNews(getMockNews());
      setHasMore(false);
    } finally {
      setLoading(false);
    }
  };

  const getMockNews = () => {
    const mockArticles = [
      {
        title: "Desenvolvimento de Software em 2025: Principais TendÃªncias",
        description: "As principais tendÃªncias e tecnologias que estÃ£o moldando o desenvolvimento de software neste ano.",
        url: "#",
        urlToImage: "https://via.placeholder.com/300x150/007bff/ffffff?text=Tech+News",
        publishedAt: new Date().toISOString(),
        source: { name: "Tech Today" }
      },
      {
        title: "InteligÃªncia Artificial: Impactos na Produtividade",
        description: "Como a IA estÃ¡ revolucionando a forma como trabalhamos e organizamos nossas tarefas diÃ¡rias.",
        url: "#",
        urlToImage: "https://via.placeholder.com/300x150/28a745/ffffff?text=AI+News",
        publishedAt: new Date(Date.now() - 3600000).toISOString(),
        source: { name: "AI Weekly" }
      },
      {
        title: "GestÃ£o de Projetos: Metodologias Ãgeis em Foco",
        description: "As melhores prÃ¡ticas para gerenciamento eficiente de projetos e tarefas em equipes modernas.",
        url: "#",
        urlToImage: "https://via.placeholder.com/300x150/ffc107/000000?text=Business",
        publishedAt: new Date(Date.now() - 7200000).toISOString(),
        source: { name: "Business Focus" }
      },
      {
        title: "Tecnologia e Produtividade: Ferramentas Essenciais",
        description: "Descubra as ferramentas mais eficazes para aumentar sua produtividade no trabalho.",
        url: "#",
        urlToImage: "https://via.placeholder.com/300x150/dc3545/ffffff?text=Productivity",
        publishedAt: new Date(Date.now() - 10800000).toISOString(),
        source: { name: "Productivity Plus" }
      }
    ];

    // Filtrar por categoria se nÃ£o for 'general'
    if (selectedCategory !== 'general') {
      const categoryMap = {
        'technology': ['Desenvolvimento', 'InteligÃªncia Artificial', 'Tecnologia'],
        'business': ['GestÃ£o de Projetos', 'Business'],
        'sports': ['Esportes', 'CompetiÃ§Ãµes'],
        'health': ['SaÃºde', 'Bem-estar'],
        'entertainment': ['Entretenimento', 'Cultura']
      };
      
      const keywords = categoryMap[selectedCategory] || [];
      if (keywords.length > 0) {
        return mockArticles.filter(article => 
          keywords.some(keyword => 
            article.title.includes(keyword) || article.description.includes(keyword)
          )
        );
      }
    }
    
    return mockArticles;
  };

  return (
    <div>
      <div style={{ display: 'flex', alignItems: 'center', marginBottom: '1rem' }}>
        <h3 style={{ margin: 0, marginRight: '1rem' }}>ğŸ“° NotÃ­cias</h3>
        {userCountry && (
          <span style={{ 
            backgroundColor: '#e9ecef', 
            padding: '0.25rem 0.5rem', 
            borderRadius: '12px', 
            fontSize: '0.8rem',
            display: 'flex',
            alignItems: 'center',
            gap: '0.25rem'
          }}>
            {userCountry.flag} {userCountry.name}
          </span>
        )}
      </div>
        <div style={{ marginBottom: '1rem', display: 'flex', gap: '0.5rem', flexWrap: 'wrap' }}>
        {categories.map(category => (
          <button
            key={category.id}
            onClick={() => setSelectedCategory(category.id)}
            style={{
              padding: '0.4rem 0.8rem',
              border: `1px solid ${darkMode ? '#555' : '#ddd'}`,
              borderRadius: '15px',
              backgroundColor: selectedCategory === category.id ? '#007bff' : (darkMode ? '#3a3a3a' : 'white'),
              color: selectedCategory === category.id ? 'white' : (darkMode ? '#fff' : '#333'),
              cursor: 'pointer',
              fontSize: '0.8rem'
            }}
          >
            {category.icon} {category.name}
          </button>
        ))}
      </div>
      
      {loading ? (
        <div style={{ textAlign: 'center', padding: '2rem' }}>
          <p>Carregando notÃ­cias...</p>
        </div>
      ) : (
        <div style={{ maxHeight: '70vh', overflowY: 'auto', paddingRight: '0.5rem' }} ref={newsContainerRef}>
          {news.length > 0 ? (
            news.map((article, index) => (
              <div key={index} style={{ 
                border: `1px solid ${darkMode ? '#555' : '#ddd'}`, 
                borderRadius: '8px', 
                padding: '1rem',
                marginBottom: '1rem',
                display: 'flex',
                flexDirection: 'column',
                gap: '0.5rem',
                backgroundColor: darkMode ? '#3a3a3a' : 'white'
              }}>
                {article.urlToImage && (
                  <img 
                    src={article.urlToImage} 
                    alt={article.title}
                    style={{ 
                      width: '100%', 
                      height: '150px', 
                      objectFit: 'cover', 
                      borderRadius: '4px'
                    }}
                  />
                )}
                <div>
                  <h4 style={{ margin: '0 0 0.5rem 0', fontSize: '0.95rem', lineHeight: '1.3' }}>                    <a 
                      href={article.url} 
                      target="_blank" 
                      rel="noopener noreferrer"
                      style={{ textDecoration: 'none', color: darkMode ? '#fff' : '#333' }}
                    >
                      {article.title}
                    </a>
                  </h4>                  {article.description && (
                    <p style={{ margin: '0 0 0.5rem 0', color: darkMode ? '#ccc' : '#666', fontSize: '0.85rem', lineHeight: '1.4' }}>
                      {article.description.substring(0, 120)}...
                    </p>
                  )}
                  <div style={{ fontSize: '0.75rem', color: darkMode ? '#aaa' : '#999' }}>
                    {article.source?.name} â€¢ {new Date(article.publishedAt).toLocaleDateString('pt-BR')}
                  </div>
                </div>
              </div>
            ))          ) : (
            <div style={{ textAlign: 'center', padding: '2rem', color: darkMode ? '#ccc' : '#666' }}>
              <p>Nenhuma notÃ­cia encontrada para esta categoria.</p>
            </div>
          )}
          {loading && <div style={{ textAlign: 'center', padding: '1rem' }}>Carregando mais notÃ­cias...</div>}
          {!hasMore && !loading && <div style={{ textAlign: 'center', padding: '1rem', color: '#aaa' }}>NÃ£o hÃ¡ mais notÃ­cias.</div>}
        </div>
      )}
    </div>
  );
}

function TasksDashboard({ tasks, onTaskUpdated, onTaskDeleted }) {
  const [filteredTasks, setFilteredTasks] = React.useState([]);
  const [filterStatus, setFilterStatus] = React.useState('todas');
  const [filterPriority, setFilterPriority] = React.useState('todas');
  const [stats, setStats] = React.useState({});

  React.useEffect(() => {
    applyFilters();
    setStats(tasksService.getStats());
  }, [tasks, filterStatus, filterPriority]);

  const applyFilters = () => {
    let filtered = tasks;

    if (filterStatus !== 'todas') {
      filtered = filtered.filter(task => task.status === filterStatus);
    }

    if (filterPriority !== 'todas') {
      filtered = filtered.filter(task => task.priority === filterPriority);
    }

    setFilteredTasks(filtered);
  };

  return (
    <div>
      <h3 style={{ marginBottom: '1rem' }}>ğŸ“‹ Dashboard de Tarefas</h3>
      
      {/* Mini Stats */}
      <div style={{ display: 'grid', gridTemplateColumns: '1fr', gap: '0.5rem', marginBottom: '1rem' }}>
        <button
          onClick={() => {
            setFilterStatus('atrasada');
            setFilteredTasks(tasks.filter(task => task.status === 'atrasada').sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate)));
          }}
          style={{
            padding: '0.5rem',
            backgroundColor: '#ffebee',
            borderRadius: '6px',
            textAlign: 'center',
            border: 'none',
            cursor: 'pointer',
            fontSize: '1rem',
            color: '#d32f2f',
            fontWeight: 'bold'
          }}
        >
          Atrasadas ({stats.overdue || 0})
        </button>
      </div>

      {/* Compact Filters */}
      <div style={{ display: 'flex', gap: '0.5rem', marginBottom: '1rem', fontSize: '0.9rem' }}>
        <select
          value={filterStatus}
          onChange={e => setFilterStatus(e.target.value)}
          style={{ padding: '0.25rem', fontSize: '0.8rem', flex: 1 }}
        >
          <option value="todas">Todos Status</option>
          <option value="pendente">Pendentes</option>
          <option value="em_progresso">Em Progresso</option>
          <option value="concluÃ­da">ConcluÃ­das</option>
        </select>
        
        <select
          value={filterPriority}
          onChange={e => setFilterPriority(e.target.value)}
          style={{ padding: '0.25rem', fontSize: '0.8rem', flex: 1 }}
        >
          <option value="todas">Todas Prioridades</option>
          <option value="baixa">Baixa</option>
          <option value="mÃ©dia">MÃ©dia</option>
          <option value="alta">Alta</option>
          <option value="urgente">Urgente</option>
        </select>
      </div>

      {/* Compact Tasks List */}
      <div style={{ maxHeight: '600px', overflowY: 'auto' }}>
        {filteredTasks.length > 0 ? (
          filteredTasks.map(task => (
            <TaskItem
              key={task._id}
              task={task}
              onTaskUpdated={onTaskUpdated}
              onTaskDeleted={onTaskDeleted}
              compact={true}
            />
          ))
        ) : (
          <div style={{ textAlign: 'center', padding: '1rem', color: '#666', fontSize: '0.9rem' }}>
            <p>Nenhuma tarefa encontrada.</p>
          </div>
        )}
      </div>
    </div>
  );
}

function CreateTaskPage({ onTaskCreated, onBack }) {
  return (
    <div style={{ maxWidth: '600px', margin: '0 auto', padding: '2rem' }}>
      <div style={{ marginBottom: '2rem' }}>
        <button 
          onClick={onBack}
          style={{ 
            padding: '0.5rem 1rem', 
            backgroundColor: '#6c757d', 
            color: 'white', 
            border: 'none', 
            borderRadius: '4px', 
            cursor: 'pointer',
            marginBottom: '1rem'
          }}
        >
          â† Voltar
        </button>
        <h2>â• Criar Nova Tarefa</h2>
      </div>
      
      <TaskForm onTaskCreated={onTaskCreated} />
    </div>
  );
}

function ProfilePage({ onBack, user, stats }) {
  const [activeSection, setActiveSection] = React.useState('info');
  const [userInfo, setUserInfo] = React.useState({
    username: user.username || '',
    email: user.email || '',
    profileImage: user.profileImage || '',
    language: user.language || 'pt',
    timezone: user.timezone || 'Europe/Lisbon',
    notifications: user.notifications !== false,
    defaultPriority: user.defaultPriority || 'mÃ©dia'
  });
  const [passwordData, setPasswordData] = React.useState({
    currentPassword: '',
    newPassword: '',
    confirmPassword: ''
  });
  const [message, setMessage] = React.useState('');

  const sections = [
    { id: 'info', name: 'ğŸ‘¤ InformaÃ§Ãµes', icon: 'ğŸ‘¤' },
    { id: 'security', name: 'ğŸ” SeguranÃ§a', icon: 'ğŸ”' },
    { id: 'preferences', name: 'âš™ï¸ PreferÃªncias', icon: 'âš™ï¸' },
    { id: 'actions', name: 'ğŸ—‘ï¸ AÃ§Ãµes', icon: 'ğŸ—‘ï¸' }
  ];

  const handleUserInfoUpdate = async () => {
    try {
      await authService.updateUserInfo(userInfo);
      setMessage('InformaÃ§Ãµes atualizadas com sucesso!');
      setTimeout(() => setMessage(''), 3000);
    } catch (error) {
      setMessage('Erro ao atualizar informaÃ§Ãµes: ' + error.message);
    }
  };

  const handlePasswordChange = async () => {
    if (passwordData.newPassword !== passwordData.confirmPassword) {
      setMessage('As senhas nÃ£o coincidem');
      return;
    }
    if (passwordData.newPassword.length < 6) {
      setMessage('A senha deve ter pelo menos 6 caracteres');
      return;
    }
    try {
      await authService.changePassword(passwordData.currentPassword, passwordData.newPassword);
      setMessage('Senha alterada com sucesso!');
      setPasswordData({ currentPassword: '', newPassword: '', confirmPassword: '' });
      setTimeout(() => setMessage(''), 3000);
    } catch (error) {
      setMessage('Erro ao alterar senha: ' + error.message);
    }
  };

  const handleLogoutAll = async () => {
    if (confirm('Tem certeza que deseja terminar todas as sessÃµes?')) {
      try {
        // Simulate logout all sessions - in a real app this would call the backend
        authService.logout();
        setMessage('Todas as sessÃµes foram terminadas. VocÃª serÃ¡ redirecionado...');
        setTimeout(() => window.location.reload(), 2000);
      } catch (error) {
        setMessage('Erro ao terminar sessÃµes: ' + error.message);
      }
    }
  };

  const handleFileUpload = async (event) => {
    const file = event.target.files[0];
    if (!file) return;

    if (file.size > 5 * 1024 * 1024) { // 5MB limit
      setMessage('Arquivo muito grande. MÃ¡ximo 5MB permitido.');
      return;
    }

    if (!file.type.startsWith('image/')) {
      setMessage('Por favor, selecione apenas arquivos de imagem.');
      return;
    }

    try {
      // Convert file to base64 for storage
      const reader = new FileReader();
      reader.onload = async (e) => {
        const base64Image = e.target.result;
        const updatedUserInfo = { ...userInfo, profileImage: base64Image };
        setUserInfo(updatedUserInfo);
        
        // Save to database
        await authService.updateUserInfo(updatedUserInfo);
        setMessage('Foto de perfil atualizada com sucesso!');
        setTimeout(() => setMessage(''), 3000);
      };
      reader.readAsDataURL(file);
    } catch (error) {
      setMessage('Erro ao fazer upload da imagem: ' + error.message);
    }
  };

  const handleExportData = async (format) => {
    try {
      const data = await tasksService.exportData(format);
      const blob = new Blob([data], { type: format === 'json' ? 'application/json' : 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `tasks_export_${new Date().toISOString().split('T')[0]}.${format}`;
      a.click();
      URL.revokeObjectURL(url);
      setMessage(`Dados exportados em ${format.toUpperCase()}!`);
    } catch (error) {
      setMessage('Erro ao exportar dados: ' + error.message);
    }
  };

  const handleDeleteAccount = async () => {
    const confirmation = prompt('Para confirmar a eliminaÃ§Ã£o da conta, digite "ELIMINAR":');
    if (confirmation === 'ELIMINAR') {
      try {
        // Delete all user data from localStorage (simulating database deletion)
        await authService.deleteAccount();
        
        // Clear all stored data
        localStorage.removeItem('authToken');
        localStorage.removeItem('user');
        localStorage.removeItem('tasks');
        
        alert('Conta eliminada com sucesso!');
        window.location.reload();
      } catch (error) {
        setMessage('Erro ao eliminar conta: ' + error.message);
      }
    }
  };

  return (
    <div style={{ maxWidth: '1000px', margin: '0 auto', padding: '2rem' }}>
      <div style={{ marginBottom: '2rem' }}>
        <button 
          onClick={onBack}
          style={{ 
            padding: '0.5rem 1rem', 
            backgroundColor: '#6c757d', 
            color: 'white', 
            border: 'none', 
            borderRadius: '4px', 
            cursor: 'pointer',
            marginBottom: '1rem'
          }}
        >
          â† Voltar
        </button>
        <h2>ğŸ‘¤ Perfil do Utilizador</h2>
      </div>

      {message && (
        <div style={{ 
          padding: '1rem', 
          marginBottom: '1rem', 
          backgroundColor: message.includes('Erro') ? '#ffebee' : '#e8f5e8',
          color: message.includes('Erro') ? '#d32f2f' : '#388e3c',
          border: `1px solid ${message.includes('Erro') ? '#d32f2f' : '#388e3c'}`,
          borderRadius: '4px'
        }}>
          {message}
        </div>
      )}

      <div style={{ display: 'grid', gridTemplateColumns: '250px 1fr', gap: '2rem' }}>
        {/* Sidebar Navigation */}
        <div style={{ backgroundColor: '#f8f9fa', padding: '1rem', borderRadius: '8px', height: 'fit-content' }}>
          {sections.map(section => (
            <button
              key={section.id}
              onClick={() => setActiveSection(section.id)}
              style={{
                width: '100%',
                padding: '0.75rem',
                marginBottom: '0.5rem',
                backgroundColor: activeSection === section.id ? '#007bff' : 'transparent',
                color: activeSection === section.id ? 'white' : '#333',
                border: 'none',
                borderRadius: '4px',
                cursor: 'pointer',
                textAlign: 'left',
                fontSize: '0.9rem'
              }}
            >
              {section.icon} {section.name}
            </button>
          ))}
        </div>

        {/* Content Area */}
        <div style={{ backgroundColor: 'white', padding: '2rem', borderRadius: '8px', border: '1px solid #ddd' }}>          {/* InformaÃ§Ãµes do Utilizador */}
          {activeSection === 'info' && (
            <div>
              <h3>ğŸ‘¤ InformaÃ§Ãµes do Utilizador</h3>
              
              <div style={{ display: 'grid', gap: '1rem', marginBottom: '2rem' }}>
                <div>
                  <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 'bold' }}>Nome</label>
                  <input
                    type="text"
                    value={userInfo.username}
                    onChange={e => setUserInfo(prev => ({ ...prev, username: e.target.value }))}
                    style={{ width: '100%', padding: '0.5rem', border: '1px solid #ddd', borderRadius: '4px' }}
                  />
                </div>
                
                <div>
                  <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 'bold' }}>Email</label>
                  <input
                    type="email"
                    value={userInfo.email}
                    onChange={e => setUserInfo(prev => ({ ...prev, email: e.target.value }))}
                    style={{ width: '100%', padding: '0.5rem', border: '1px solid #ddd', borderRadius: '4px' }}
                  />
                </div>
                
                <div>
                  <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 'bold' }}>Foto de perfil</label>
                  <div style={{ display: 'flex', alignItems: 'center', gap: '1rem' }}>
                    {userInfo.profileImage && (
                      <img 
                        src={userInfo.profileImage} 
                        alt="Perfil atual" 
                        style={{ width: '80px', height: '80px', borderRadius: '50%', objectFit: 'cover', border: '2px solid #ddd' }}
                      />
                    )}
                    <div>
                      <input
                        type="file"
                        accept="image/*"
                        onChange={handleFileUpload}
                        style={{ marginBottom: '0.5rem' }}
                      />
                      <div style={{ fontSize: '0.8rem', color: '#666' }}>
                        MÃ¡ximo 5MB. Formatos: JPG, PNG, GIF
                      </div>
                      {userInfo.profileImage && (
                        <button
                          type="button"
                          onClick={() => setUserInfo(prev => ({ ...prev, profileImage: '' }))}
                          style={{ 
                            marginTop: '0.5rem',
                            padding: '0.25rem 0.5rem', 
                            backgroundColor: '#dc3545', 
                            color: 'white', 
                            border: 'none', 
                            borderRadius: '4px', 
                            cursor: 'pointer',
                            fontSize: '0.8rem'
                          }}
                        >
                          ğŸ—‘ï¸ Remover foto
                        </button>
                      )}
                    </div>
                  </div>
                </div>
                
                <div>
                  <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 'bold' }}>Data de registo</label>
                  <input
                    type="text"
                    value={new Date(user.createdAt).toLocaleDateString('pt-PT')}
                    disabled
                    style={{ width: '100%', padding: '0.5rem', border: '1px solid #ddd', borderRadius: '4px', backgroundColor: '#f5f5f5' }}
                  />
                </div>
              </div>
              
              <button 
                onClick={handleUserInfoUpdate}
                style={{ 
                  padding: '0.75rem 1.5rem', 
                  backgroundColor: '#28a745', 
                  color: 'white', 
                  border: 'none', 
                  borderRadius: '4px', 
                  cursor: 'pointer' 
                }}
              >
                ğŸ’¾ Guardar alteraÃ§Ãµes
              </button>
            </div>
          )}          {/* SeguranÃ§a */}
          {activeSection === 'security' && (
            <div>
              <h3>ğŸ” SeguranÃ§a</h3>
              
              <div style={{ marginBottom: '2rem' }}>
                <h4>Alterar palavra-passe</h4>
                <div style={{ display: 'grid', gap: '1rem', marginBottom: '1rem' }}>
                  <div>
                    <label style={{ display: 'block', marginBottom: '0.5rem' }}>Senha atual</label>
                    <input
                      type="password"
                      value={passwordData.currentPassword}
                      onChange={e => setPasswordData(prev => ({ ...prev, currentPassword: e.target.value }))}
                      style={{ width: '100%', padding: '0.5rem', border: '1px solid #ddd', borderRadius: '4px' }}
                    />
                  </div>
                  <div>
                    <label style={{ display: 'block', marginBottom: '0.5rem' }}>Nova senha</label>
                    <input
                      type="password"
                      value={passwordData.newPassword}
                      onChange={e => setPasswordData(prev => ({ ...prev, newPassword: e.target.value }))}
                      style={{ width: '100%', padding: '0.5rem', border: '1px solid #ddd', borderRadius: '4px' }}
                    />
                  </div>
                  <div>
                    <label style={{ display: 'block', marginBottom: '0.5rem' }}>Confirmar nova senha</label>
                    <input
                      type="password"
                      value={passwordData.confirmPassword}
                      onChange={e => setPasswordData(prev => ({ ...prev, confirmPassword: e.target.value }))}
                      style={{ width: '100%', padding: '0.5rem', border: '1px solid #ddd', borderRadius: '4px' }}
                    />
                  </div>
                </div>
                <button 
                  onClick={handlePasswordChange}
                  style={{ 
                    padding: '0.5rem 1rem', 
                    backgroundColor: '#007bff', 
                    color: 'white', 
                    border: 'none', 
                    borderRadius: '4px', 
                    cursor: 'pointer' 
                  }}
                >
                  ğŸ” Alterar senha
                </button>
              </div>
              
              <div>
                <h4>SessÃµes</h4>
                <p style={{ color: '#666', fontSize: '0.9rem' }}>Termine sua sessÃ£o atual em todos os dispositivos.</p>
                <button 
                  onClick={handleLogoutAll}
                  style={{ 
                    padding: '0.5rem 1rem', 
                    backgroundColor: '#ffc107', 
                    color: '#212529', 
                    border: 'none', 
                    borderRadius: '4px', 
                    cursor: 'pointer' 
                  }}
                >
                  ğŸšª Terminar todas as sessÃµes
                </button>
              </div>
            </div>
          )}

          {/* PreferÃªncias */}
          {activeSection === 'preferences' && (
            <div>
              <h3>âš™ï¸ PreferÃªncias</h3>
              
              <div style={{ display: 'grid', gap: '1.5rem' }}>
                <div>
                  <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 'bold' }}>Idioma</label>
                  <select
                    value={userInfo.language}
                    onChange={e => setUserInfo(prev => ({ ...prev, language: e.target.value }))}
                    style={{ width: '100%', padding: '0.5rem', border: '1px solid #ddd', borderRadius: '4px' }}
                  >
                    <option value="pt">ğŸ‡µğŸ‡¹ PortuguÃªs</option>
                    <option value="en">ğŸ‡ºğŸ‡¸ English</option>
                    <option value="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
                    <option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
                  </select>
                </div>
                
                <div>
                  <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 'bold' }}>Fuso horÃ¡rio</label>
                  <select
                    value={userInfo.timezone}
                    onChange={e => setUserInfo(prev => ({ ...prev, timezone: e.target.value }))}
                    style={{ width: '100%', padding: '0.5rem', border: '1px solid #ddd', borderRadius: '4px' }}
                  >
                    <option value="Europe/Lisbon">ğŸ‡µğŸ‡¹ Lisboa (UTC+0/+1)</option>
                    <option value="America/Sao_Paulo">ğŸ‡§ğŸ‡· SÃ£o Paulo (UTC-3)</option>
                    <option value="America/New_York">ğŸ‡ºğŸ‡¸ Nova York (UTC-5/-4)</option>
                    <option value="Europe/London">ğŸ‡¬ğŸ‡§ Londres (UTC+0/+1)</option>
                    <option value="Europe/Paris">ğŸ‡«ğŸ‡· Paris (UTC+1/+2)</option>
                  </select>
                </div>
                
                <div>
                  <label style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', cursor: 'pointer' }}>
                    <input
                      type="checkbox"
                      checked={userInfo.notifications}
                      onChange={e => setUserInfo(prev => ({ ...prev, notifications: e.target.checked }))}
                    />
                    <span>ğŸ”” Ativar notificaÃ§Ãµes e lembretes</span>
                  </label>
                  <small style={{ color: '#666', marginLeft: '1.5rem' }}>
                    Receba lembretes sobre tarefas prÃ³ximas do prazo
                  </small>
                </div>
                
                <div>
                  <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 'bold' }}>Prioridade padrÃ£o para novas tarefas</label>
                  <select
                    value={userInfo.defaultPriority}
                    onChange={e => setUserInfo(prev => ({ ...prev, defaultPriority: e.target.value }))}
                    style={{ width: '100%', padding: '0.5rem', border: '1px solid #ddd', borderRadius: '4px' }}
                  >
                    <option value="baixa">ğŸŸ¢ Baixa</option>
                    <option value="mÃ©dia">ğŸŸ¡ MÃ©dia</option>
                    <option value="alta">ğŸŸ  Alta</option>
                    <option value="urgente">ğŸ”´ Urgente</option>
                  </select>
                </div>
              </div>
              
              <button 
                onClick={handleUserInfoUpdate}
                style={{ 
                  padding: '0.75rem 1.5rem', 
                  backgroundColor: '#28a745', 
                  color: 'white', 
                  border: 'none', 
                  borderRadius: '4px', 
                  cursor: 'pointer',
                  marginTop: '1.5rem'
                }}
              >
                ğŸ’¾ Guardar preferÃªncias
              </button>
            </div>
          )}

          {/* AÃ§Ãµes crÃ­ticas */}
          {activeSection === 'actions' && (
            <div>
              <h3>ğŸ—‘ï¸ AÃ§Ãµes crÃ­ticas</h3>
              
              <div style={{ display: 'grid', gap: '2rem' }}>
                <div>
                  <h4>ğŸ“Š Exportar dados</h4>
                  <p style={{ color: '#666', fontSize: '0.9rem' }}>
                    Baixe todos os seus dados (tarefas, configuraÃ§Ãµes) em formato JSON ou CSV.
                  </p>
                  <div style={{ display: 'flex', gap: '1rem' }}>
                    <button 
                      onClick={() => handleExportData('json')}
                      style={{ 
                        padding: '0.5rem 1rem', 
                        backgroundColor: '#17a2b8', 
                        color: 'white', 
                        border: 'none', 
                        borderRadius: '4px', 
                        cursor: 'pointer' 
                      }}
                    >
                      ğŸ“¥ Exportar JSON
                    </button>
                    <button 
                      onClick={() => handleExportData('csv')}
                      style={{ 
                        padding: '0.5rem 1rem', 
                        backgroundColor: '#28a745', 
                        color: 'white', 
                        border: 'none', 
                        borderRadius: '4px', 
                        cursor: 'pointer' 
                      }}
                    >
                      ğŸ“Š Exportar CSV
                    </button>
                  </div>
                </div>
                
                <div style={{ borderTop: '1px solid #ddd', paddingTop: '2rem' }}>
                  <h4 style={{ color: '#dc3545' }}>âš ï¸ Zona de perigo</h4>
                  <p style={{ color: '#666', fontSize: '0.9rem' }}>
                    Esta aÃ§Ã£o nÃ£o pode ser desfeita. Todos os seus dados serÃ£o permanentemente eliminados.
                  </p>
                  <button 
                    onClick={handleDeleteAccount}
                    style={{ 
                      padding: '0.75rem 1.5rem', 
                      backgroundColor: '#dc3545', 
                      color: 'white', 
                      border: 'none', 
                      borderRadius: '4px', 
                      cursor: 'pointer',
                      fontWeight: 'bold'
                    }}
                  >
                    ğŸ—‘ï¸ Eliminar conta permanentemente
                  </button>
                </div>
              </div>
            </div>
          )}
        </div>
      </div>
    </div>
  );
}

function Dashboard() {
  const [tasks, setTasks] = React.useState([]);
  const [user, setUser] = React.useState(null);
  const [currentView, setCurrentView] = React.useState('dashboard'); // 'dashboard', 'create', or 'profile'
  const [stats, setStats] = React.useState({});
  const [darkMode, setDarkMode] = React.useState(false);
  React.useEffect(() => {
    loadTasks();
    const userData = authService.getUser();
    setUser(userData);
    
    // Load dark mode preference
    const savedDarkMode = localStorage.getItem('darkMode') === 'true';
    setDarkMode(savedDarkMode);
    document.body.style.backgroundColor = savedDarkMode ? '#121212' : '#ffffff';
    document.body.style.color = savedDarkMode ? '#ffffff' : '#000000';
  }, []);

  const toggleDarkMode = () => {
    const newDarkMode = !darkMode;
    setDarkMode(newDarkMode);
    localStorage.setItem('darkMode', newDarkMode.toString());
    
    // Apply dark mode styles to body
    document.body.style.backgroundColor = newDarkMode ? '#121212' : '#ffffff';
    document.body.style.color = newDarkMode ? '#ffffff' : '#000000';
  };

  const loadTasks = async () => {
    try {
      const tasksData = await tasksService.getTasks();
      setTasks(tasksData);
      setStats(tasksService.getStats());
    } catch (error) {
      console.error('Erro ao carregar tarefas:', error);
    }
  };

  const handleTaskCreated = (newTask) => {
    setTasks(prev => [newTask, ...prev]);
    setStats(tasksService.getStats());
    setCurrentView('dashboard'); // Volta para o dashboard apÃ³s criar
  };

  const handleTaskUpdated = (updatedTask) => {
    setTasks(prev => prev.map(task => 
      task._id === updatedTask._id ? updatedTask : task
    ));
    setStats(tasksService.getStats());
  };
  
  const handleTaskDeleted = (taskId) => {
    setTasks(prev => prev.filter(task => task._id !== taskId));
    setStats(tasksService.getStats());
  };
  
  const handleLogout = () => {
    authService.logout();
    window.location.reload();
  };

  if (currentView === 'create') {
    return (
      <CreateTaskPage 
        onTaskCreated={handleTaskCreated}
        onBack={() => setCurrentView('dashboard')}
      />
    );
  }

  if (currentView === 'profile') {
    return (
      <ProfilePage 
        onBack={() => setCurrentView('dashboard')}
        user={user}
        stats={stats}
      />
    );
  }
  return (
    <div style={{ 
      maxWidth: '1400px', 
      margin: '0 auto', 
      padding: '1rem',
      backgroundColor: darkMode ? '#1a1a1a' : '#ffffff',
      color: darkMode ? '#ffffff' : '#000000',
      minHeight: '100vh'
    }}>
      <header style={{ 
        display: 'flex', 
        justifyContent: 'space-between', 
        alignItems: 'center', 
        marginBottom: '1rem', 
        paddingBottom: '1rem', 
        borderBottom: `1px solid ${darkMode ? '#333' : '#ddd'}`,
        backgroundColor: darkMode ? '#fff' : '#fff',
        color: '#000',
        padding: '0.5rem 2rem 1.5rem 2rem', // padding-top reduzido
        borderRadius: '0',
        boxShadow: '0 2px 8px 0 rgba(0,0,0,0.03)',
        minHeight: '80px',
      }}>
        <div style={{ display: 'flex', alignItems: 'center', gap: '1rem' }}>
          <img src="https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f4dd.png" alt="logo" style={{ width: 40, height: 40, marginRight: 10, verticalAlign: 'middle' }} />
          <span style={{ fontWeight: 700, fontSize: '2.5rem', letterSpacing: '-1px' }}>To-Do List & NotÃ­cias</span>
        </div>
        <div style={{ display: 'flex', alignItems: 'center', gap: '2rem' }}>
          <button 
            onClick={() => setCurrentView('create')}
            style={{ 
              display: 'flex', alignItems: 'center', gap: 6,
              padding: '0.5rem 1.2rem', 
              backgroundColor: '#00ff22', 
              color: '#fff', 
              border: 'none', 
              borderRadius: '8px', 
              fontWeight: 600,
              fontSize: '1.1rem',
              cursor: 'pointer',
              boxShadow: '0 2px 8px 0 rgba(0,0,0,0.07)'
            }}
          >
            <span style={{ fontSize: '1.3rem' }}>â•</span> Nova Tarefa
          </button>
          <button 
            onClick={toggleDarkMode}
            style={{ 
              width: 48, height: 48, borderRadius: '50%', border: 'none',
              background: '#8ba0b2', color: '#fff', fontSize: '1.5rem',
              display: 'flex', alignItems: 'center', justifyContent: 'center',
              boxShadow: '0 2px 8px 0 rgba(0,0,0,0.07)', cursor: 'pointer'
            }}
            title={darkMode ? 'Modo claro' : 'Modo escuro'}
          >
            <span style={{ fontSize: '1.5rem' }}>ğŸŒ™</span>
          </button>
          {user && (
            <span style={{ display: 'flex', alignItems: 'center', gap: 6, fontSize: '1.1rem', fontWeight: 500 }}>
              <span style={{ color: '#7c3aed', fontSize: '1.3rem' }}>ğŸ‘¤</span> {user.username}
              {user.country && (
                <span style={{ fontSize: '1.1rem', marginLeft: 2 }}>
                  {countries.find(c => c.code === user.country)?.flag}
                </span>
              )}
              <span style={{ fontSize: '0.8rem', color: '#888', marginLeft: 2 }}>PT</span>
            </span>
          )}
          <button 
            onClick={handleLogout}
            style={{ 
              display: 'flex', alignItems: 'center', gap: 6,
              padding: '0.5rem 1.2rem', 
              backgroundColor: '#ff0033', 
              color: '#fff', 
              border: 'none', 
              borderRadius: '8px', 
              fontWeight: 600,
              fontSize: '1.1rem',
              cursor: 'pointer',
              boxShadow: '0 2px 8px 0 rgba(0,0,0,0.07)'
            }}
          >
            <span style={{ fontSize: '1.3rem' }}>ğŸšª</span> Sair
          </button>
        </div>
      </header>      {/* Layout em duas colunas */}
      <div style={{ display: 'grid', gridTemplateColumns: '1fr 400px', gap: '2rem', height: 'calc(100vh - 150px)' }}>
        {/* Coluna esquerda - NotÃ­cias */}        <div style={{ 
          overflow: 'hidden',
          backgroundColor: darkMode ? '#2a2a2a' : '#f8f9fa',
          padding: '1.5rem',
          borderRadius: '8px',
          border: `1px solid ${darkMode ? '#444' : '#ddd'}`
        }}>
          <NewsSection darkMode={darkMode} />
        </div>

        {/* Coluna direita - Dashboard de Tarefas */}
        <div style={{ 
          padding: '1rem', 
          border: `1px solid ${darkMode ? '#444' : '#ddd'}`, 
          borderRadius: '8px', 
          backgroundColor: darkMode ? '#2a2a2a' : '#f8f9fa',
          overflow: 'hidden'
        }}>
          <TasksDashboard
            tasks={tasks}
            onTaskUpdated={handleTaskUpdated}
            onTaskDeleted={handleTaskDeleted}
          />
        </div>
      </div>
    </div>
  );
}

function App() {
  const [currentPage, setCurrentPage] = React.useState('login');
  const [isAuthenticated, setIsAuthenticated] = React.useState(false);

  React.useEffect(() => {
    setIsAuthenticated(authService.isAuthenticated());
  }, []);

  if (isAuthenticated) {
    return <Dashboard />;
  }

  return (
    <div>
      {currentPage === 'login' ? (
        <LoginPage onSwitchToRegister={() => setCurrentPage('register')} />
      ) : (
        <RegisterPage onSwitchToLogin={() => setCurrentPage('login')} />
      )}
    </div>
  );
}

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<App />);
        </script>
    </body>
</html>